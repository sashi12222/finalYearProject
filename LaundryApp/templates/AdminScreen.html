{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Laundry at Ease{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3><i class="bi bi-speedometer2 me-2"></i>Admin Dashboard</h3>
            </div>
            <div class="card-body">
                {% if data %}
                {% if '<table' in data %}
                <!-- If data contains a table, it will be handled differently -->
                {% else %}
                <div class="alert alert-info mb-4">
                    {{ data|safe }}
                </div>
                {% endif %}
                {% endif %}
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <i class="bi bi-bag-check-fill mb-3" style="font-size: 2rem;"></i>
                                <h4>Manage Orders</h4>
                                <p>View and update customer orders</p>
                                <a href="{% url 'ViewOrderStatus' %}" class="btn btn-light">
                                    <i class="bi bi-list-check me-1"></i> View Orders
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <i class="bi bi-people-fill mb-3" style="font-size: 2rem;"></i>
                                <h4>Customer Accounts</h4>
                                <p>Manage registered user accounts</p>
                                <a href="{% url 'ViewCustomers' %}" class="btn btn-light">
                                    <i class="bi bi-person-lines-fill me-1"></i> View Customers
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <i class="bi bi-graph-up-arrow mb-3" style="font-size: 2rem;"></i>
                                <h4>System Dashboard</h4>
                                <p>View system performance metrics</p>
                                <a href="{% url 'index' %}" class="btn btn-light">
                                    <i class="bi bi-box-arrow-right me-1"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if data and '<table' in data %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h4>
                    {% if 'Customer Details' in data %}
                    <i class="bi bi-people me-2"></i>Customer Management
                    {% else %}
                    <i class="bi bi-list-check me-2"></i>Order Management
                    {% endif %}
                </h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    {{ data|safe }}
                </div>
            </div>
        </div>
    </div>
		</div>
{% endif %}

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="orderDetailsModalLabel">Order Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="orderModalBody">
                <!-- Content will be dynamically populated -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		</div>
	</div>
	</div>
	</div>
{% endblock %}

{% block extra_js %}
<script>
    // JavaScript to enhance the table generated by the backend
    document.addEventListener('DOMContentLoaded', function() {
        // Find all tables in the card body
        const tables = document.querySelectorAll('.card-body table');
        
        // Add Bootstrap classes to each table
        tables.forEach(table => {
            // Add classes to table
            table.classList.add('table', 'table-striped', 'table-hover');
            table.style.width = '100%';
            
            // Create table header if it doesn't exist
            if (!table.querySelector('thead')) {
                const headerRow = table.rows[0];
                const thead = document.createElement('thead');
                thead.appendChild(headerRow.cloneNode(true));
                table.insertBefore(thead, table.firstChild);
                headerRow.remove();
            }
            
            // Style the table header
            const headerRow = table.querySelector('thead tr');
            if (headerRow) {
                headerRow.querySelectorAll('th, td').forEach(cell => {
                    cell.style.backgroundColor = 'var(--primary-color)';
                    cell.style.color = 'white';
                    cell.style.fontWeight = 'bold';
                    // Improve text contrast and readability
                    cell.style.textShadow = '0 1px 0 rgba(0,0,0,0.2)';
                });
            }
            
            // Add classes to tbody if it doesn't exist
            if (!table.querySelector('tbody')) {
                const tbody = document.createElement('tbody');
                Array.from(table.querySelectorAll('tr')).forEach((row, index) => {
                    if (index > 0) { // Skip header row
                        tbody.appendChild(row.cloneNode(true));
                    }
                });
                
                // Remove all rows except header
                Array.from(table.querySelectorAll('tr')).forEach((row, index) => {
                    if (index > 0) { // Skip header row
                        row.remove();
                    }
                });
                
                table.appendChild(tbody);
            }
            
            // Add Bootstrap classes to status badges for order table
            if (table.querySelector('tbody tr td:nth-last-child(3)')) {
                const statusCells = table.querySelectorAll('tbody tr td:nth-last-child(3)');
                statusCells.forEach(cell => {
                    const status = cell.textContent.trim();
                    if (status === 'Pending') {
                        cell.innerHTML = '<span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>Pending</span>';
                    } else if (status === 'Completed') {
                        cell.innerHTML = '<span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Completed</span>';
                    } else if (status === 'Processing') {
                        cell.innerHTML = '<span class="badge bg-info"><i class="bi bi-arrow-repeat me-1"></i>Processing</span>';
                    }
                });
            }
            
            // Make images responsive and clickable for larger view
            const images = table.querySelectorAll('img');
            images.forEach(img => {
                // Save the original src
                const originalSrc = img.src;
                
                // Create a wrapper for the image
                const wrapper = document.createElement('div');
                wrapper.classList.add('text-center');
                img.parentNode.insertBefore(wrapper, img);
                wrapper.appendChild(img);
                
                // Style the image
                img.classList.add('img-thumbnail-custom');
                img.setAttribute('data-bs-toggle', 'modal');
                img.setAttribute('data-bs-target', '#orderDetailsModal');
                
                // Add click event to show the image in a modal
                img.addEventListener('click', function() {
                    // Update the modal content
                    let modalContent = '<div class="text-center">';
                    modalContent += '<img src="' + originalSrc + '" class="img-fluid rounded" style="max-height: 500px;">';
                    modalContent += '</div>';
                    
                    document.getElementById('orderModalBody').innerHTML = modalContent;
                    document.getElementById('orderDetailsModalLabel').textContent = 'Laundry Image';
                });
                
                // Add view button
                const viewBtn = document.createElement('button');
                viewBtn.classList.add('btn', 'btn-sm', 'btn-outline-primary', 'mt-2');
                viewBtn.innerHTML = '<i class="bi bi-eye"></i> View';
                viewBtn.setAttribute('data-bs-toggle', 'modal');
                viewBtn.setAttribute('data-bs-target', '#orderDetailsModal');
                viewBtn.addEventListener('click', function() {
                    img.click();
                });
                
                wrapper.appendChild(document.createElement('br'));
                wrapper.appendChild(viewBtn);
            });
            
            // Make the links prettier
            const links = table.querySelectorAll('a');
            links.forEach(link => {
                if (link.textContent.includes('Click Here')) {
                    link.classList.add('btn', 'btn-sm', 'btn-outline-primary');
                    link.innerHTML = '<i class="bi bi-pencil"></i> Update Status';
                }
            });
        });
    });
</script>
{% endblock %}
